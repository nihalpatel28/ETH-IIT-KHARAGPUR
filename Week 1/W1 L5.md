# Ethical Hacking – Week 1

## Lecture 05: TCP/IP Protocol Stack (II)

> **Purpose of these notes**  
> These notes are written for **easy revision and teaching**. Concepts are explained clearly, step‑by‑step, with **ASCII diagrams** so that you can explain them confidently to others.

---

## Topics Covered

- IP Datagram
- IP Header Fields (IPv4)
- IP Layer Characteristics
- IP Encapsulation
- IP Header Checksum
- Viewing IP Packets

---

## 1. IP Datagram

An **IP datagram** is the basic unit of data transfer in the IP layer.

### Key Characteristics of IP Layer

- Connectionless delivery
- Unreliable service
- Best‑effort delivery
- No guarantee of packet delivery
- No history is maintained by IP
- Each packet is **independent** of others

```
Sender ──► [ IP Packet ] ──► Network ──► Receiver
(each packet treated independently)
```

> Reliability is handled by **TCP**, not IP.

---

## 2. IP Layer Encapsulation

### What Happens at IP Layer

- IP receives data from **Transport layer (TCP or UDP)**
- Adds an **IP header (minimum 20 bytes)**
- Forwards packet to Data Link layer

```
Transport Data
      ↓
+------------------+
|   IP Header      |  (20 bytes minimum)
+------------------+
|   Data           |
+------------------+
```

### Purpose of IP Header

- Routing information
- Source and destination addresses
- Fragmentation handling
- Flow handling

---

## 3. Format of IP Datagram (IPv4)

- Each row is **32 bits (4 bytes)**
- Minimum header size = **20 bytes**

```
+----+----+------------+------------------+
|VER |HLEN| ServiceType|   Total Length   |
+----------------------+------------------+
|     Identification   |Flags|Frag Offset |
+----------------------+------------------+
|  TTL | Protocol |   Header Checksum    |
+----------------------------------------+
|          Source IP Address              |
+----------------------------------------+
|        Destination IP Address           |
+----------------------------------------+
| Options (if any)                        |
+----------------------------------------+
|                 DATA                   |
+----------------------------------------+
```

---

## 4. IP Header Fields (Detailed)

### (a) Version (VER – 4 bits)

- Identifies IP version in use
- Here: **IPv4**

---

### (b) Header Length (HLEN – 4 bits)

- Length of IP header in **32‑bit words**
- Minimum value = **5 (20 bytes)**
- Maximum value = **15**

---

### (c) Total Length

- Total size of datagram (header + data)
- Measured in **bytes**
- Maximum size:

```
2^16 = 65536 bytes
```

---

### (d) Service Type (8 bits)

- Assigns **priority** to packets
- Routers may use this field for better routing decisions

---

### (e) Time To Live (TTL – 8 bits)

- Prevents packets from looping endlessly
- Sender sets TTL value
- Decremented by **1 at each router**
- Packet discarded when TTL = 0

```
TTL = 5 → 4 → 3 → 2 → 1 → 0 ❌ (discarded)
```

---

### (f) Protocol (8 bits)

- Identifies the **upper‑layer protocol**

Examples:
- TCP = 6
- UDP = 17
- ICMP = 1

---

### (g) Source IP Address (32 bits)

- IP address of **sender**

---

### (h) Destination IP Address (32 bits)

- IP address of **receiver**

---

### (i) Identification, Flags, Fragment Offset

- Used for **fragmentation and reassembly**
- Helps receiver reconstruct original packet

---

### (j) Options (Variable Length)

- Optional field
- Used only if router supports it
- Example: source routing

---

## 5. IP Header Checksum

### Purpose

- Detects errors **only in IP header**
- Does NOT cover data portion

### How Checksum is Calculated

1. Header treated as sequence of **16‑bit integers**
2. All fields added using **one’s complement arithmetic**
3. One’s complement of final sum = checksum

```
Header Fields → Add → One's Complement → Checksum
```

- Computed automatically by hardware
- If checksum mismatch → packet is discarded

---

## 6. Viewing IP Packets

We can inspect IP packets using **packet sniffers**.

### Common Tools

- Wireshark
- Windump
- tcpdump
- Tshark
- SolarWinds

```
Network Traffic → Packet Sniffer → IP Header Analysis
```

> Very important for **ethical hacking, forensics, and troubleshooting**.

---

## 7. Why This Lecture is Important for Ethical Hacking

- Understanding packet structure helps in:
  - Packet sniffing
  - Spoofing attacks
  - DoS analysis
  - Firewall evasion techniques

---

## ✅ End of Lecture 05 Notes

You can use these notes to:
- Revise quickly before exams
- Teach IP fundamentals clearly
- Understand how attackers analyze packets

