# Ethical Hacking – Week 1

## Lecture 04: TCP/IP Protocol Stack

> **Goal of these notes**: Detailed, exam-ready, and easy to teach.  
> Includes **clear explanations + ASCII diagrams** based strictly on the handwritten Lecture-04 PDF.

---

## Topics Covered

- TCP/IP Protocol Stack
- OSI Model vs TCP/IP Model
- Functions of TCP, UDP, and IP
- TCP/IP Protocol Suite
- ARP, RARP, ICMP, IGMP
- Addresses in TCP/IP
- Data Encapsulation

---

## 1. Introduction to TCP/IP

- TCP/IP is the **most fundamental protocol suite of the Internet**
- Allows computers to:
  - Communicate
  - Share resources
- Works as a **standard** across platforms
  - Windows, Linux, macOS, ATMs, routers, etc.
- Bridges the gap between **non-compatible systems**

### History
- Work started in the **1970s**
- Funded by the **US Military (ARPA – Advanced Research Projects Agency)**

---

## 2. TCP/IP vs OSI Model

### OSI Model (7 Layers)

```
Application
Presentation
Session
Transport
Network
Data Link
Physical
```

### TCP/IP Model (4 Layers)

```
Application
Transport
Network
Data Link
```

### Key Differences
- TCP/IP does **not strictly follow OSI**
- TCP/IP is **simpler and practical**
- OSI is a **reference model**, TCP/IP is **implemented in real networks**

---

## 3. Data Flow in TCP/IP (4-Layer Model)

```
Sender                          Receiver
------                          --------
Application  ───────────────▶  Application
Transport    ───────────────▶  Transport
Network      ──Router(s)───▶   Network
Data Link    ───────────────▶  Data Link
```

- Routing decisions happen at the **Network layer**
- Data Link layer chooses the **best next hop**

---

## 4. TCP/IP Protocol Suite

TCP/IP is a **family of protocols**, not a single protocol.

### Application Layer
- FTP – File Transfer Protocol
- TFTP – Trivial File Transfer Protocol
- SMTP – Email transfer
- SNMP – Network management
- DNS – Name resolution

### Transport Layer
- **TCP** – Transmission Control Protocol
- **UDP** – User Datagram Protocol

### Network Layer
- IP – Internet Protocol
- ICMP – Error reporting
- IGMP – Multicast management
- ARP / RARP – Address resolution

### Data Link Layer
- Ethernet
- Hardware-specific technologies

---

## 5. Address Resolution Protocols

### ARP (Address Resolution Protocol)
- Converts **IP address → MAC address**

```
IP Address ──ARP──▶ MAC Address
```

### RARP (Reverse ARP)
- Converts **MAC address → IP address**

```
MAC Address ──RARP──▶ IP Address
```

---

## 6. ICMP & IGMP

### ICMP (Internet Control Message Protocol)
- Sends error & control messages
- Examples:
  - Destination unreachable
  - Service not available

### IGMP (Internet Group Management Protocol)
- Used for **multicast communication**
- Nodes inform routers about:
  - Multicast group membership

---

## 7. Typical TCP/IP Communication Scenario

```
User Process
     ↓
    TCP / UDP
     ↓
      IP
     ↓
Data Link (Ethernet)
```

- TCP or UDP hands packets to IP
- IP delivers packets using routing

---

## 8. What Does IP Do?

- Transports packets from **source to destination**
- Responsible for routing
- Can fragment large packets

### IP is Unreliable
- Packets may be lost
- Packets may arrive out of order
- Duplicate packets may be generated

```
IP = Best-effort delivery
(No guarantee)
```

---

## 9. What Does TCP Do?

- Connection-oriented
- Reliable service

### TCP Functions
- Splits message into packets
- Reassembles packets at destination
- Retransmits lost packets
- Performs error control

```
Message → Packets → Reliable Delivery → Message
```

---

## 10. What Does UDP Do?

- Connectionless
- Unreliable
- Faster than TCP

### UDP Characteristics
- Sends small messages (e.g., DNS queries)
- No error recovery
- No packet retransmission

```
Send it once → If lost, ignore
```

---

## 11. Addresses in TCP/IP

```
Application → Port Number (16-bit)
Transport   → Port Address
Network     → IP Address (32-bit)
Data Link   → MAC Address (48-bit)
```

### Address Hierarchy
- Port → Identifies application
- IP → Identifies host
- MAC → Identifies hardware

---

## 12. Encapsulation (Very Important)

### Basic Concept
- As data moves **down**, headers are **added**
- As data moves **up**, headers are **removed**

---

### Example: TFTP using UDP

- TFTP uses **UDP**, not TCP
- Client sends **400 bytes of data**
- Headers added layer by layer

### Encapsulation at Sender

```
[ TFTP Data ]
[ UDP | TFTP Data ]
[ IP | UDP | TFTP Data ]
[ ETH | IP | UDP | TFTP Data | ETH ]
```

### Decapsulation at Receiver

```
ETH removed
IP removed
UDP removed
TFTP data delivered
```

---

## 13. Why Encapsulation Matters (Ethical Hacking)

- Packet sniffing
- Protocol analysis
- Understanding attacks at each layer
- Helps in:
  - Wireshark analysis
  - Network troubleshooting

---

## ✅ End of Lecture 04 Notes

These notes are perfect for:
- Exams
- Teaching TCP/IP clearly
- Understanding network-level attacks
- Ethical hacking fundamentals
